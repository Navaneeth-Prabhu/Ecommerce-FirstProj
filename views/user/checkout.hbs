      {{!-- <div class="modal fade" id="productView" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content overflow-hidden border-0">
            <button class="btn-close p-4 position-absolute top-0 end-0 z-index-20 shadow-0" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body p-0">
              <div class="row align-items-stretch">
                <div class="col-lg-6 p-lg-0"><a class="glightbox product-view d-block h-100 bg-cover bg-center" style="background: url(img/product-5.jpg)" href="img/product-5.jpg" data-gallery="gallery1" data-glightbox="Red digital smartwatch"></a><a class="glightbox d-none" href="img/product-5-alt-1.jpg" data-gallery="gallery1" data-glightbox="Red digital smartwatch"></a><a class="glightbox d-none" href="img/product-5-alt-2.jpg" data-gallery="gallery1" data-glightbox="Red digital smartwatch"></a></div>
                <div class="col-lg-6">
                  <div class="p-4 my-md-4">
                    <ul class="list-inline mb-2">
                      <li class="list-inline-item m-0"><i class="fas fa-star small text-warning"></i></li>
                      <li class="list-inline-item m-0 1"><i class="fas fa-star small text-warning"></i></li>
                      <li class="list-inline-item m-0 2"><i class="fas fa-star small text-warning"></i></li>
                      <li class="list-inline-item m-0 3"><i class="fas fa-star small text-warning"></i></li>
                      <li class="list-inline-item m-0 4"><i class="fas fa-star small text-warning"></i></li>
                    </ul>
                    <h2 class="h4">Red digital smartwatch</h2>
                    <p class="text-muted">$250</p>
                    <p class="text-sm mb-4">Lorem ipsum dolor sit amet, consectetur adipiscing elit. In ut ullamcorper leo, eget euismod orci. Cum sociis natoque penatibus et magnis dis parturient montes nascetur ridiculus mus. Vestibulum ultricies aliquam convallis.</p>
                    <div class="row align-items-stretch mb-4 gx-0">
                      <div class="col-sm-7">
                        <div class="border d-flex align-items-center justify-content-between py-1 px-3"><span class="small text-uppercase text-gray mr-4 no-select">Quantity</span>
                          <div class="quantity">
                            <button class="dec-btn p-0"><i class="fas fa-caret-left"></i></button>
                            <input class="form-control border-0 shadow-0 p-0" type="text" value="1">
                            <button class="inc-btn p-0"><i class="fas fa-caret-right"></i></button>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-5"><a class="btn btn-dark btn-sm w-100 h-100 d-flex align-items-center justify-content-center px-0" href="cart.html">Add to cart</a></div>
                    </div><a class="btn btn-link text-dark text-decoration-none p-0" href="#!"><i class="far fa-heart me-2"></i>Add to wish list</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> --}}
      <div class="container">
        <!-- HERO SECTION-->
        <section class="py-5 bg-light">
          <div class="container">
            <div class="row px-4 px-lg-5 py-lg-4 align-items-center">
              <div class="col-lg-6">
                <h1 class="h2 text-uppercase mb-0">Checkout</h1>
              </div>
              <div class="col-lg-6 text-lg-end">
                <nav aria-label="breadcrumb">
                  <ol class="breadcrumb justify-content-lg-end mb-0 px-0 bg-light">
                    <li class="breadcrumb-item"><a class="text-dark" href="index.html">Home</a></li>
                    <li class="breadcrumb-item"><a class="text-dark" href="/cart">Cart</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                  </ol>
                </nav>
              </div>
            </div>
          </div>
        </section>
        <section class="py-5">
          <!-- BILLING ADDRESS-->
          <h2 class="h5 text-uppercase mb-4">Billing details</h2>
          <div class="row">
            <div class="col-lg-8">
              <form action="/checkout/?id={{user._id}}" method="post" id="checkout" name="checkout">
                <div class="row gy-3">
                  <div class="col-lg-6">
                    <input class="form-control form-control-lg" type="number" id="offerp" name="offerp" value="{{total}}" hidden>
                    <label class="form-label text-sm text-uppercase" for="firstName">First name </label>
                    <input class="form-control form-control-lg" type="text" id="name" name="name" value="{{user.Name}}">
                  </div>




       
                  <div class="col-lg-6">
                    <label class="form-label text-sm text-uppercase" for="address">Address</label>
                    <input class="form-control form-control-lg" type="text" id="addresss" name="address" value="">
                  </div>
                  <div class="col-lg-6">
                    <label class="form-label text-sm text-uppercase" for="city">city</label>
                    <input class="form-control form-control-lg" type="text" id="citys" name="city" value="">
                  </div>
                  <div class="col-lg-6">
                    <label class="form-label text-sm text-uppercase" for="state">State</label>
                    <input class="form-control form-control-lg" type="text" id="states" name="state" value="">
                  </div>
                  <div class="col-lg-6">
                    <label class="form-label text-sm text-uppercase" for="pin">pin</label>
                    <input class="form-control form-control-lg" type="number" id="pins" name="pin" value="">
                  </div>
                  {{!-- <div class="col-lg-6">
                    <label class="form-label text-sm text-uppercase" for="company">Company name (optional) </label>
                    <input class="form-control form-control-lg" type="text" id="company" placeholder="Your company name">
                  </div> --}}

                  <input type="text" name="userId" id="" value="{{user._id}}" hidden>
                  <div class="col-lg-6 form-group">
                    <label class="form-label text-sm text-uppercase" for="country">Country</label>
                    <select class="country" id="country" data-customclass="form-control form-control-lg rounded-0">
                      <option value>India</option>
                    </select>
                  </div>


                    <H5>ADDRESS</H5>
                    <a class="btn btn-primary" href="/add-address?userId={{user._id}}">Add-Address</a>
                  {{#each address}}
                    <label for="address" id="addressLabel" class=" radio-inline">
                    <input type="radio" name="address" value="{{this.address}},{{this.city}},{{this.state}},{{this.pin}}" id="address_id"  onclick="addtoplace( `{{this.address}}`,`{{this.city}}`,`{{this.state}}`,`{{this.pin}}`)" required>
                    {{this.address}},{{this.city}}
                    <input type="text" name="address_id" id="address_id" value="{{this._id}}" hidden>
                    {{!-- <input type="text" name="" id="" value="{{this.address}},{{this.city}},{{this.state}},{{this.pin}}"  /> --}}
                  </label>
                  {{/each}}
                


                  <h5>PAYMENT METHOD</h5>
                  {{#if gwallet}}
                  <label for="" class=" radio-inline">
                    <input type="radio" name="payment-method" value="Wallet" onclick="toggle()" required>Wallet
                  </label>
                  {{else}}
                  <label for="" class=" radio-inline">
                    <input type="radio" name="payment-method" value="Wallet" onclick="toggle()" disabled>Wallet
                    <span class="small">   oops !! you dont have enough money in wallet</span>
                  </label>
                  {{/if}}
                  <label for="" class=" radio-inline">
                    <input type="radio" name="payment-method" value="COD" onclick="toggle()" required>COD
                  </label>
                  <label for="" class="radio-inline">
                    <input type="radio" name="payment-method" value="razorpay" onclick="toggle()" required>RazorPay
                  </label>
                  <label for="" class="radio-inline">
                    <input type="radio" name="payment-method" value="paypal" onclick="toggle1()" required >PayPal
                  </label>
        
                  <div class="col-lg-12 form-group">
                     <div class="btn clr" id="paypal-button-container"></div>
                    <button class="btn btn-dark clr" type="submit" id="co">Place order</button>
                  </div>
                </div>

              </form>
            </div>
            {{!-- <div class="payment">
                            <p>Payment method</p>
                            <label class="radio-inline" >
                                <input type="radio" name="Payment-method" value="COD" onclick="toggle()" required>COD
                            </label><br>
                            <label class="radio-inline" >
                                <input type="radio" name="Payment-method" value="paypal" onclick="toggle1()" required>Paypal
                            </label><br>
                            <label class="radio-inline mt-2">
                                <input type="radio" name="Payment-method" value="Online-Payment" onclick="toggle()" required>Razorpay Payment
                            </label><br><br>
                            {{#if coupon}}
                            <input type="text" name="coupon" value={{coupon.off}} style="display: none;">
                            {{/if}}
                            <button type="submit" class="float-rleft btn-primary clr" id="co">Checkout</button>
                      
                            <div id="paypal-button-container" style="margin-top: 1rem;" class="clr"></div>
                        </div> --}}




            <!-- ORDER SUMMARY-->
            <div class="col-lg-4">
              <div class="card border-0 rounded-0 p-lg-4 bg-light">
                <div class="card-body">
                  <h5 class="text-uppercase mb-4">Your order</h5>
                  <ul class="list-unstyled mb-0">
                    {{!-- <li class="d-flex align-items-center justify-content-between"><strong class="small fw-bold"></strong><span class="text-muted small">$250</span></li> --}}
                    <li class="border-bottom my-2"></li>
                    {{!-- <li class="d-flex align-items-center justify-content-between"><strong class="small fw-bold"></strong><span class="text-muted small">$351</span></li> --}}
                    {{!-- <li class="border-bottom my-2"></li> --}}
                    <li class="d-flex align-items-center justify-content-between"><strong class="text-uppercase small fw-bold">Total</strong><span>{{total}}</span></li><br>
                    <li class="d-flex align-items-center justify-content-between"><strong class="text-uppercase small fw-bold">Offer</strong><span id="total">{{total}}</span></li>
                     
                    <li>

                    </li>
                    <li>
                      {{!-- <form action="/verifyCoupon" method="post"> --}}
                       <div class="input-group">
                        <div class="input-group mb-0">
                          <input class="form-control" type="text" placeholder="Enter your coupon" name="coupon" id="applycoup" value="helo">
                          <button class="btn btn-dark btn-sm w-100" type="submit" onclick="addcoupon()"> Apply coupon</button>
                        </div>
                       </div>
                      {{!-- </form> --}}
                      {{!-- <div class="input-group">
                        <input type="text" class="form-control" placeholder="Promo code" name="coupon" id="applycoup">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-secondary" onclick="addcoupon()">Redeem</button>
                            <p id="msg" style="color:rgb(255, 0, 0) "></p>
                        </div>
                      </div> --}}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

        </section>
      
      <!-- JavaScript files-->
      <!-- JavaScript files-->
      {{!-- <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
      <script src="vendor/glightbox/js/glightbox.min.js"></script>
      <script src="vendor/nouislider/nouislider.min.js"></script>
      <script src="vendor/swiper/swiper-bundle.min.js"></script>
      <script src="vendor/choices.js/public/assets/scripts/choices.min.js"></script> --}}
      {{!-- <script src="javascript/front.js"></script> --}}
      <script>
        // ------------------------------------------------------- //
        //   Inject SVG Sprite - 
        //   see more here 
        //   https://css-tricks.com/ajaxing-svg-sprite/
        // ------------------------------------------------------ //
        function injectSvgSprite(path) {
        
            var ajax = new XMLHttpRequest();
            ajax.open("GET", path, true);
            ajax.send();
            ajax.onload = function(e) {
            var div = document.createElement("div");
            div.className = 'd-none';
            div.innerHTML = ajax.responseText;
            document.body.insertBefore(div, document.body.childNodes[0]);
            }
        }
        // this is set to BootstrapTemple website as you cannot 
        // inject local SVG sprite (using only 'icons/orion-svg-sprite.svg' path)
        // while using file:// protocol
        // pls don't forget to change to your domain :)
        injectSvgSprite('https://bootstraptemple.com/files/icons/orion-svg-sprite.svg'); 
        
      </script>
      <!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    


<style>
  .clr {
    display: none !important;
  }
  .sft {
   display: block !important;
  }
</style>


<script>
  $("#checkout").submit((e)=>{
    e.preventDefault()
    $.ajax({
      url:'/checkout',
      method:'post',
      data:$('#checkout').serialize(),
      success:(response)=>{ 
        if(response.cod_success)
        {
          location.href='/orderSucessfull'
          
        } else if(response.wallet_success == true) {
          console.log('hi hi hihihihihihihihiiihhii')
          location.href = '/orderSucessfull'
        }
        else if(response) {
          location.href = '/orderSucessfull'
        }
        else{
            razorPayment(response)
            console.log('helo:',response)
        }    
        }
    })
  })

  function razorPayment(order) {
    
    var options = {
        "key": "rzp_test_t1yn2Ez97FhcF6", // Enter the Key ID generated from the Dashboard
        "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "WATCH",
        "description": "Test Transaction",
        "image": "/images/resize-1661314920805561225Group1.jpg",
        "order_id":order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response){
             
            
            verifyPayment(response,order)
        },
        "prefill": {
            "name": "xxxx",
            "email": "xxxxx@gmail.com",
            "contact": "9999999999"
        },
        "notes": {
            "address": "Razorpay Corporate Office"
        },
        "theme": {
            "color": "#F37254"
        }
    };

    var rzp1 = new Razorpay(options);
    rzp1.open();

}
function verifyPayment(payment,order){
   console.log("in verifyPayment");
    $.ajax({
        url:'/verify-payment',
        data:{
        payment,
        order
    },
    method:'post',
    success:((response) =>{
      console.log("",response)
        if(response.status){
            location.href='/orderSucessfull'
        }else{
          alert('payment failed')
        }
      })
    })
}

paypal
  .Buttons({
    // Sets up the transaction when a payment button is clicked
    createOrder: async function (data, actions) {
      return fetch("/api/orders", {
        method: "post",
      })
        .then((response) => response.json())
        .then((response) => {
          console.log(response);
          return response.id;
        });
    },

    // Finalize the transaction after payer approval
    onApprove:async  function (data, actions) {
      return fetch(`/api/orders/${data.orderID}/capture`, {
        method: "post",
      })
        .then((response) => response.json())
        .then(function (orderData) {
          // Successful capture! For dev/demo purposes:
          console.log(
            "Capture result",
            orderData,
            JSON.stringify(orderData, null, 2)
          );
          var transaction = orderData.purchase_units[0].payments.captures[0];

          $( "#co" ).trigger( "click" );
          // When ready to go live, remove the alert and show a success message within this page. For example:
          // var element = document.getElementById('paypal-button-container');
          // element.innerHTML = '';
          // element.innerHTML = '<h3>Thank you for your payment!</h3>';
          // Or go to another URL:  actions.redirect('thank_you.html');
          
        });

    },
  })
  .render("#paypal-button-container");
 

  </script>

<script type = "text/javascript">
  function toggle() {
    const list = document.getElementById("co").classList;
    const list2 = document.getElementById("paypal-button-container").classList;
    list.add("sft");
    list2.remove("sft");
  
  }
   function toggle1() {
      const list = document.getElementById("co").classList;
    const list2 = document.getElementById("paypal-button-container").classList;
    list2.add("sft");
    list.remove("sft");
  }

  function addtoplace(address,city,state,pin){
    console.log('hello im here')
    let add = document.getElementById('addresss').value = address
    let cityname = document.getElementById('citys').value = city
    let statename = document.getElementById('states').value = state
    let pinname = document.getElementById('pins').value = pin

  }

  function addcoupon() {
                console.log("in add coupon")
                let sum = document.getElementById('total').innerHTML

                 let coupon = document.getElementById('couponvalue')
                let couponname = document.getElementById('applycoup').value   
                  let couponusing = document.getElementById('couponusing')
                alert(couponname)
                console.log("sum:",sum)
                console.log("coupon:",coupon)
                $.ajax({
                    url: '/applyCoupon',
                    method: 'post',
                    data: { promo: couponname },

                    success: (response) => {
                        console.log(response);
                        if (response.status == false) {
                            let error = document.getElementById('msg')
                            error.innerHTML = 'Enter valid Promocode'
                        } else {
                            Swal.fire({
                                position: 'top-end',
                                icon: 'success',
                                title: 'COUPON APPLIED',
                                showConfirmButton: false,
                                timer: 1500
                            })
                            
                            if( Number(sum)-(Number(sum)*(Number(response.coupon.off)/100)) > 20000)
                            {
                              document.getElementById('total').innerHTML =  Number(sum)-1000;
                              let input= document.getElementById('offerp')
                              input.value =  Number(sum)-1000;
                              console.log("hehe",input.value)
                              console.log("sum:",sum)

                            }else{
                              document.getElementById('total').innerHTML =  Number(sum)-(Number(sum)*(Number(response.coupon.off)/100));
                              let input= document.getElementById('offerp')
                              input.value = Number(sum)-(Number(sum)*(Number(response.coupon.off)/100));
                              console.log("hehe",input.value)
                              console.log("sum:",sum)

                            }
      

                         
                           
                        }
                    }
                })
            }
</script>
                {{!-- let sum= document.getElementById('total').value --}}
